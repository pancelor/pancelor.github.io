<!DOCTYPE html>
<html>
<head>
<title>pancelor dot com</title>
<link rel="icon" type="image/png" href="/assets/favicon.png">
<link rel="stylesheet" href="/stylesheets/opensans.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/rainbow.min.css">
<link rel="stylesheet" href="/stylesheets/main.css">
<script async defer
src="https://stats.pancelor.com/umami.js"
data-website-id="0c389f03-0316-468f-bc0c-56471a5057df"
data-domains="pancelor.com"></script>

</head>
<body>
<div class="wrapper">
<div class="header">
  <a href="/index#fishy"><div class="header-banner"></div></a>
</div>
<section class="main-content">
<h1 class="post-title">Fishy</h1>
<h4 class="post-meta">2020-11</h4>

<p>This was a submission to <a href="https://itch.io/jam/tweet-tweet-jam-5">TweetTweetJam 5</a>, a game jame where your entire game must fit into 560 characters (aka the length of two tweets).</p>
<p>Play it online <a href="https://pancelor.itch.io/fishy">here</a>! It’s pretty small but I’m proud of how fun I managed to make it, given the space constraints.</p>
<h3 id="gameplay-video">gameplay video</h3>
<figure>
  <video loop controls autoplay muted>
    <source src="/assets/fishy.mp4" type="video/mp4">
  </video>
  <figcaption>my highscore is getting to level 11; <a href="https://twitter.com/pancelor/status/1326391289676443648">let me know</a> if you manage to get farther!</figcaption>
</figure>

<h3 id="the-code">the code</h3>
<p>In the end, the final character count was 555:</p>
<pre><code class="language-lua">l=1poke2(12800,582)r=rnd::t::q=&quot;g=128h=1.5f={64,64,h,0}for i=5,g,4do
f[i]=r(g)f[i+1]=r(g)f[i+2]=r(2+l/4)f[i+3]=r(3)-1end::b::cls(1)u=0for i=1,#f,4do
x=f[i]+f[i+3]if i&lt;2then
b=btn()x+=b\2%2-b%2f[i+1]+=b\8%2-b\4%2end
f[i]=x%g
y=f[i+1]s=f[i+2]u+=s
for j=i+4,#f,4do
w=f[j+2]e=s+w
if e&gt;abs(x-f[j])and e&gt;abs(y-f[j+1])then
k=j+i
if(s&lt;w)j=i
k-=j
f[j]=j
sfx(0)f[j+1]=-9f[j+2]=0f[k+2]+=w/8if(j&lt;2)q=&quot;lose\n ❎&quot;end
end
ovalfill(x-s*h,y-s,x+s*h,y+s,8+i%7+sgn(i-2))end
?l,62,4,7
if(u==f[3])q=&quot;win!\n ❎&quot;l+=1
flip()::a::
if(btnp(5))goto t
if(#q&lt;1)goto b
?q,56,64,7
goto a
</code></pre>
<h3 id="okay-what">okay what</h3>
<p>Yeah, it’s certainly not optimized for readability, heh. Here’s a much earlier version that should give you an idea of how it works:</p>
<pre><code class="language-lua">r=rnd

n=<span class="hljs-number">6</span>
<span class="hljs-comment">-- 0,1,2   ,3 ,4  ,5</span>
<span class="hljs-comment">-- x,y,size,dx,col,dy</span>
f={
  <span class="hljs-number">64</span>,<span class="hljs-number">64</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gen</span><span class="hljs-params">(i)</span></span>
 f[i]=r(<span class="hljs-number">120</span>)+<span class="hljs-number">4</span>
 f[i+<span class="hljs-number">1</span>]=r(<span class="hljs-number">128</span>)
 f[i+<span class="hljs-number">2</span>]=r(<span class="hljs-number">2</span>)
 f[i+<span class="hljs-number">3</span>]=r(<span class="hljs-number">4</span>)<span class="hljs-number">-2</span>
 f[i+<span class="hljs-number">4</span>]=<span class="hljs-number">7</span>
<span class="hljs-comment">-- f[i+5]=r(1)-0.5</span>
 f[i+<span class="hljs-number">5</span>]=<span class="hljs-number">0</span>

 <span class="hljs-keyword">if</span>(i==<span class="hljs-number">1</span>)lose=<span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span>+n,n*<span class="hljs-number">20</span>,n <span class="hljs-keyword">do</span>
  gen(i)
<span class="hljs-keyword">end</span>

::b::
cls(<span class="hljs-number">1</span>)
 <span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span>,#f,n <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> i==<span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
   <span class="hljs-keyword">if</span> lose <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;lose&quot;</span>,<span class="hljs-number">56</span>,<span class="hljs-number">64</span>)
   <span class="hljs-keyword">else</span>
     f[<span class="hljs-number">1</span>]+=<span class="hljs-number">1</span>-(<span class="hljs-number">1</span>+btn()&amp;<span class="hljs-number">3</span>)%<span class="hljs-number">3</span>
     f[<span class="hljs-number">2</span>]+=<span class="hljs-number">1</span>-(<span class="hljs-number">1</span>+(btn()&amp;<span class="hljs-number">12</span>))%<span class="hljs-number">3</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  x=f[i]+f[i+<span class="hljs-number">3</span>]
  <span class="hljs-keyword">if</span>(x&gt;<span class="hljs-number">128</span>)f[i+<span class="hljs-number">3</span>]*=<span class="hljs-number">-1</span>
  <span class="hljs-keyword">if</span>(x&lt;<span class="hljs-number">1</span>)f[i+<span class="hljs-number">3</span>]*=<span class="hljs-number">-1</span>
  f[i]=x
  y=f[i+<span class="hljs-number">1</span>]+f[i+<span class="hljs-number">5</span>]
  f[i+<span class="hljs-number">1</span>]=y
  s=f[i+<span class="hljs-number">2</span>]
  <span class="hljs-comment">-- collide</span>
  <span class="hljs-keyword">for</span> j=i+n,#f,n <span class="hljs-keyword">do</span>
   dx=<span class="hljs-built_in">abs</span>(x-f[j])
   dy=<span class="hljs-built_in">abs</span>(y-f[j+<span class="hljs-number">1</span>])
   s2=f[j+<span class="hljs-number">2</span>]
   d=s+s2
   <span class="hljs-keyword">if</span> dx&lt;d <span class="hljs-keyword">and</span> dy&lt;d <span class="hljs-keyword">then</span>
    ismall=s&lt;s2 <span class="hljs-keyword">and</span> i <span class="hljs-keyword">or</span> j
    ibig=ismall^^i^^j
    gen(ismall)
    pre=f[ibig+<span class="hljs-number">2</span>]
    f[ibig+<span class="hljs-number">2</span>]+=<span class="hljs-number">0.5</span><span class="hljs-comment">--f[ismall+2]^0.2</span>
    f[ibig+<span class="hljs-number">3</span>]*=<span class="hljs-number">0.7</span>
    <span class="hljs-keyword">if</span> ismall==<span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
     f[ibig+<span class="hljs-number">4</span>]=<span class="hljs-number">12</span>
    <span class="hljs-keyword">end</span>
   <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  ovalfill(x-s,y-s/<span class="hljs-number">2</span>,x+s,y+s/<span class="hljs-number">2</span>,f[i+<span class="hljs-number">4</span>])
 <span class="hljs-keyword">end</span>
flip()
<span class="hljs-keyword">goto</span> b
</code></pre>
<p>The basic idea is that all the fish are stored in a giant flattened array of attributes. So, <code>f[1]</code> through <code>f[6]</code> are the data values for the player, <code>f[7]</code> through <code>f[12]</code> are the data values for the first random fish, and so on. (The player is stored in the same array as everyone else to make the code simpler and smaller)</p>
<p>Each frame, all the fish update according to their <code>dx</code> attribute. The fish check for (rectangular) collisions against every other fish, and consume and grow if they were the bigger fish. In this old version, the dead fish gets re-generated at a random other point in the world, buuut this made the endgame slightly… weird, so I ended up changing that for the final version:</p>
<figure>
  <video loop controls muted>
    <source src="/assets/fishy-old.mp4" type="video/mp4">
  </video>
  <figcaption>hmmmm (flashing lights warning)</figcaption>
</figure>

<h3 id="cool-trick-8-way-movement">cool trick: 8-way movement</h3>
<p>For the player movement, I wanted to figure something out that did this logic in fewer characters:</p>
<pre><code class="language-lua"><span class="hljs-keyword">if</span>(btn(<span class="hljs-number">0</span>))x-=<span class="hljs-number">1</span>
<span class="hljs-keyword">if</span>(btn(<span class="hljs-number">1</span>))x+=<span class="hljs-number">1</span>
<span class="hljs-keyword">if</span>(btn(<span class="hljs-number">2</span>))y-=<span class="hljs-number">1</span>
<span class="hljs-keyword">if</span>(btn(<span class="hljs-number">3</span>))y+=<span class="hljs-number">1</span>
</code></pre>
<p>That’s 59 characters; can we do better? What do we need to do to make <code>x+=magic(...)</code> do exactly what I want? Well, <code>btn()</code> (when called with no arguments) returns a bitfield of all currently-held buttons, and I knew I wanted the output of my hypothetical <code>magic</code> function to be either 0, -1, or 1, so I tried defining <code>magic</code> to be <code>1-(more_magic(btn())%3)</code>. After messing around with this for a while, I came up with this:</p>
<pre><code class="language-lua">b=btn()
x+=<span class="hljs-number">1</span>-(<span class="hljs-number">1</span>+b&amp;<span class="hljs-number">3</span>)%<span class="hljs-number">3</span>
y+=<span class="hljs-number">1</span>-(<span class="hljs-number">1</span>+(b&amp;<span class="hljs-number">12</span>))%<span class="hljs-number">3</span>
</code></pre>
<p>40 characters! And the linebreaks are optional in this snippet (but not the first one, for arcane pico-8 parser reasons). I used this incantation for a while until I saw someone post something <a href="https://twitter.com/DaleJ_Dev/status/1324856184470446080">even shorter</a>, saving another 5 characters.</p>
<h3 id="cool-trick-xor-swap">cool trick: xor swap</h3>
<p>Another cool trick I used was using the xor operator to swap the value of two variables:</p>
<pre><code class="language-lua">ismall=s&lt;s2 <span class="hljs-keyword">and</span> i <span class="hljs-keyword">or</span> j
ibig=ismall^^i^^j
</code></pre>
<p>Here, I wanted to figure out which fish index was the bigger fish, <code>i</code> or <code>j</code>. That first line figures out which fish is smaller, but I also want to know which fish is bigger! A similar line of code works of course (<code>ibig=s&lt;s2 and j or i</code>), but using xor like this (<code>^^</code>) saves precious characters.</p>
<p>…oh, and now that I’ve written this all up, I’ve suddenly realized that I can save an additional 2 characters by doing the swap this way instead:</p>
<pre><code class="language-lua">ismall=s&lt;s2 <span class="hljs-keyword">and</span> i <span class="hljs-keyword">or</span> j
ibig=i+j-ismall
</code></pre>
<p>If only pico-8’s xor was spelled with one character instead of two… using xor for stuff like this is cool!! Oh well, gotta save those characters. :D</p>
<h3 id="game-design">game design</h3>
<p>This project taught me a surprising amount about game design. My initial attempts at making this weren’t very fun, and they were a bit too chaotic (see the above video, lol). But, as I specifically worked on addressing those issues, the game become more and more fun, which was exciting to notice as it happened.</p>
<p>The first big improvement was getting rid of fish permanently when they get eaten, instead of respawning them. This removed the endgame chaos, and gave the game a nice goal state. Then later, I had saved enough characters in various ways to be able to add in a level progression system, which made the game a lot more compelling.</p>
<p>It’s often easy to imagine that game design is some ineffable magic secret sauce that can’t be broken down or examined, so it was illuminating to notice that no actually, for this game I was able to identify and concretely address multiple game design issues, leading to a more fun game in the end.</p>
<p>Overall this was a really fun project! Tweetcarts are fun to make :)</p>
</section>
<div class="end-spacer"></div>
<div class="footer">© pancelor 2021</div>

</body>
</html>
